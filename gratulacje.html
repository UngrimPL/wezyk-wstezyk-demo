<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gratulacje â€“ WÄ™Å¼yk WstÄ™Å¼yk</title>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#ffffff;color:#0b0d0f}
    .wrap{max-width:900px;margin:40px auto;padding:0 20px;text-align:center}
    h1{font-size:clamp(24px,4vw,36px);margin:0 0 12px}
    p{margin:6px 0 20px}
    .row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .btn{cursor:pointer;border:0;border-radius:12px;padding:14px 18px;background:linear-gradient(180deg,#22c55e,#16a34a);color:#052e16;font-weight:800}
    a.btn{text-decoration:none;display:inline-block}
    footer{margin-top:24px;color:#6b7280;font-size:12px}
    @media (max-width:560px){.wrap{margin:20px auto;padding:0 14px}.row{gap:10px}.btn{width:100%}}
    .msg{font-size:13px;color:#6b7280}
    .err{color:#b91c1c}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸŽ‰ Gratulacje!</h1>
    <p id="mainText">Twoja nagroda od <b>WÄ™Å¼yka WstÄ™Å¼yka</b> jest gotowa!</p>
    <p id="genderText">WykazaÅ‚eÅ›(aÅ›) siÄ™ Å›wietnÄ… spostrzegawczoÅ›ciÄ… â€” dlatego czeka na Ciebie nagroda: osobista kolorowanka oraz dyplom z imieniem.</p>
    <div class="row">
      <a id="downloadColor" class="btn" href="#">Pobierz kolorowankÄ™</a>
      <button id="btnDiploma" class="btn">Pobierz dyplom</button>
    </div>
    <p class="msg" id="colorMsg"></p>
    <p style="margin-top:10px"><a href="index.html">WrÃ³Ä‡</a></p>
    <footer>Â© WÄ™Å¼yk WstÄ™Å¼yk 2025</footer>
  </div>

<script>
  // --- PARAMETRY Z URL ---
  const params=new URLSearchParams(location.search);
  const name=params.get('name')||'Twoje imiÄ™';
  const gender=params.get('gender')||'dziewczynka';
  const art=params.get('art')||'plac-budowy';
  const code=params.get('code')||'';

  const ART_LABELS={
    'plac-budowy':'Plac budowy',
    'wiejskie-zycie':'Wiejskie Å¼ycie',
    'dzien-na-farmie':'DzieÅ„ na farmie',
    'miejska-uliczka':'Miejska uliczka'
  };

  const ART_PDFS={
    'plac-budowy':'assets/pdfs/plac-budowy.pdf',
    'wiejskie-zycie':'assets/pdfs/wiejskie-zycie.pdf',
    'dzien-na-farmie':'assets/pdfs/dzien-na-farmie.pdf',
    'miejska-uliczka':'assets/pdfs/miejska-uliczka.pdf'
  };

  const colorMsg=document.getElementById('colorMsg');
  const downloadLink=document.getElementById('downloadColor');

  async function ensureExists(url){
    try{
      const res=await fetch(url,{method:'HEAD'});
      return res.ok;
    }catch(e){return false;}
  }

  downloadLink.addEventListener('click',async (e)=>{
    e.preventDefault();
    const url=ART_PDFS[art];
    if(!url){
      colorMsg.textContent='Brak pliku dla tej kolorowanki.';
      colorMsg.className='msg err';
      return;
    }
    const ok=await ensureExists(url);
    if(!ok){
      colorMsg.textContent='Nie znaleziono pliku: '+url+' (sprawdÅº Å›cieÅ¼kÄ™ i wielkoÅ›Ä‡ liter w repo).';
      colorMsg.className='msg err';
      return;
    }
    colorMsg.textContent='Pobieranieâ€¦'; 
    colorMsg.className='msg';

    const a=document.createElement('a');
    a.href=url; 
    a.download=(ART_LABELS[art]||'kolorowanka')+'.pdf';
    document.body.appendChild(a); 
    a.click(); 
    a.remove();

    colorMsg.textContent='';
  });

  const genderText=document.getElementById('genderText');
  if(gender==='chlopiec'){
    genderText.textContent='WykazaÅ‚eÅ› siÄ™ Å›wietnÄ… spostrzegawczoÅ›ciÄ… â€” dlatego czeka na Ciebie nagroda: osobista kolorowanka oraz dyplom z imieniem.';
  } else {
    genderText.textContent='WykazaÅ‚aÅ› siÄ™ Å›wietnÄ… spostrzegawczoÅ›ciÄ… â€” dlatego czeka na Ciebie nagroda: osobista kolorowanka oraz dyplom z imieniem.';
  }

  // ------------- FONT Z POLSKIMI ZNAKAMI (Inter) -------------
  // W tym miejscu wklejasz base64 wygenerowane przez konwerter jsPDF:
  // ZAMIEN "PASTE_BASE64_HERE" NA PRAWDZIWY, DÅUGI CIÄ„G Z KONWERTERA
  (function(){
    const { jsPDF } = window.jspdf;

    const INTER_REGULAR = "PASTE_BASE64_HERE";

    // Rejestracja fontu w jsPDF
    jsPDF.API.addFileToVFS("Inter-Regular.ttf", INTER_REGULAR);
    jsPDF.API.addFont("Inter-Regular.ttf", "InterPDF", "normal");
    jsPDF.API.addFont("Inter-Regular.ttf", "InterPDF", "bold");
  })();

  function titleByGender(g){
    return g==='dziewczynka' ? 'Super-Kolorystka' : 'Super-Kolorysta';
  }
function removePolish(s) {
  return s
    .replace(/Ä…/g, "a").replace(/Ä‡/g, "c").replace(/Ä™/g, "e")
    .replace(/Å‚/g, "l").replace(/Å„/g, "n").replace(/Ã³/g, "o")
    .replace(/Å›/g, "s").replace(/Å¼/g, "z").replace(/Åº/g, "z")
    .replace(/Ä„/g, "A").replace(/Ä†/g, "C").replace(/Ä˜/g, "E")
    .replace(/Å/g, "L").replace(/Åƒ/g, "N").replace(/Ã“/g, "O")
    .replace(/Åš/g, "S").replace(/Å»/g, "Z").replace(/Å¹/g, "Z");
}

function drawDiploma(doc){
  doc.setFillColor(255,255,255);
  doc.rect(0,0,210,297,'F');
  doc.setTextColor(0,0,0);

  const cleanName = removePolish(name);
  const cleanArt  = removePolish(ART_LABELS[art] || art);
  const cleanTitle = removePolish(titleByGender(gender));

  doc.setFont('helvetica','bold');
  doc.setFontSize(26);
  doc.text('Dyplom ' + cleanTitle, 105, 36, {align:'center'});

  doc.setFontSize(38);
  doc.text(cleanName,105,70,{align:'center'});

  doc.setFont('helvetica','normal');
  doc.setFontSize(14);

  const line1 = 'Za wspaniale kolorowanie sceny:';
  const line2 = cleanArt;
  const line3 = 'i kreatywnosc bez granic!';

  doc.text(line1, 105, 92, {align:'center'});
  doc.text(line2, 105, 100, {align:'center'});
  doc.text(line3, 105, 108, {align:'center'});

  doc.setDrawColor(0,0,0);
  doc.setLineWidth(0.8);
  doc.roundedRect(40,120,130,18,6,6,'S');

  doc.setFont('helvetica','bold');
  doc.setFontSize(16);
  doc.text('Wezyk Wstezyk',105,133,{align:'center'});

  doc.setFont('helvetica','normal');
  doc.setFontSize(11);
  doc.text('Kod zamowienia: ' + removePolish(code),105,160,{align:'center'});

  doc.setLineWidth(1.2);
  doc.circle(105,205,28,'S');
  doc.setFont('helvetica','bold');
  doc.setFontSize(14);
  doc.text('BRAWO!',105,203,{align:'center'});

  doc.setFontSize(10);
  doc.text('SUPER KOLOROWANIE',105,213,{align:'center'});

  doc.setFont('helvetica','normal');
  doc.setFontSize(10);
  doc.text('Data: '+new Date().toLocaleDateString('pl-PL'),20,286);
  doc.text('Â© Wezyk Wstezyk 2025',190,286,{align:'right'});
}

  document.getElementById('btnDiploma').addEventListener('click',()=>{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:'mm',format:'a4'});
    drawDiploma(doc);
    doc.save('dyplom_'+name.replace(/\s+/g,'_')+'.pdf');
  });
</script>
</body>
</html>
